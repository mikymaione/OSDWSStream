<!DOCTYPE html>
<html>

<head>
	<title>This is a title</title>
</head>

<body>
	<video id="remoteVideo" playsinline autoplay></video>

	<script>
		let startTime;
		let localStream;
		let pc1;
		let pc2;

		const remoteVideo = document.getElementById('remoteVideo');

		function gotRemoteStream(e)
		{
			if (remoteVideo.srcObject !== e.streams[0])
			{
				remoteVideo.srcObject = e.streams[0];
				console.log('pc2 received remote stream');
			}
		}

		async function call()
		{
			startTime = window.performance.now();
			const videoTracks = localStream.getVideoTracks();
			const audioTracks = localStream.getAudioTracks();

			if (videoTracks.length > 0)
				console.log(`Using video device: ${videoTracks[0].label}`);

			if (audioTracks.length > 0)
				console.log(`Using audio device: ${audioTracks[0].label}`);

			const configuration = {};
			console.log('RTCPeerConnection configuration:', configuration);

			pc1 = new RTCPeerConnection(configuration);
			console.log('Created local peer connection object pc1');

			pc1.addEventListener('icecandidate', e => onIceCandidate(pc1, e));
			pc2 = new RTCPeerConnection(configuration);
			console.log('Created remote peer connection object pc2');

			pc2.addEventListener('icecandidate', e => onIceCandidate(pc2, e));
			pc1.addEventListener('iceconnectionstatechange', e => onIceStateChange(pc1, e));
			pc2.addEventListener('iceconnectionstatechange', e => onIceStateChange(pc2, e));
			pc2.addEventListener('track', gotRemoteStream);

			localStream.getTracks().forEach(track => pc1.addTrack(track, localStream));
			console.log('Added local stream to pc1');

			try
			{
				console.log('pc1 createOffer start');
				const offer = await pc1.createOffer(offerOptions);
				await onCreateOfferSuccess(offer);
			}
			catch (e)
			{
				console.log(`Failed to create session description: ${e.toString()}`);
			}
		}

		call();
	</script>
</body>

</html>